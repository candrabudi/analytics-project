<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch and Spreadsheet Example</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@12.2.0/dist/handsontable.full.min.css">
    <script src="https://cdn.jsdelivr.net/npm/handsontable@12.2.0/dist/handsontable.full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h2>Spreadsheet with Fetch Data</h2>

<div>
    <input type="text" id="searchInput" placeholder="Search...">
    <input type="text" id="daterange" placeholder="Date Range (startdate to enddate)">
    <button onclick="loadData()">Load Data</button>
</div>

<div id="spreadsheet"></div>

<script>
    // Inisialisasi Handsontable
    const container = document.getElementById('spreadsheet');
    let hot = new Handsontable(container, {
        data: [],  // Data awal kosong, akan diisi dari hasil fetch
        colHeaders: [
            'No', 'Account Name', 'Campaign Name', 'Campaign Budget', 'Amount Spent (IDR)', 
            'Adds of Payment Info', 'Cost per Add of Payment Info', 'Leads', 'Cost per Lead',
            'Donations', 'Reach', 'Impressions', 'CPM', 'Link Clicks', 'CPC', 
            'Purchases', 'Cost per Purchase', 'Adds to Cart', 'Cost per Add to Cart', 
            'Reporting Starts', 'Reporting Ends'
        ],
        rowHeaders: true,
        manualColumnResize: true,
        manualRowResize: true,
        stretchH: 'all',
        licenseKey: 'non-commercial-and-evaluation'
    });

    // Function loadData untuk fetch data dan menampilkan ke Handsontable
    function loadData() {
        const search = $('#searchInput').val();
        const dateRange = $('#daterange').val();
        const [startdate, enddate] = dateRange ? dateRange.split(' to ') : ['', ''];

        const params = new URLSearchParams({
            search,
            startdate,
            enddate
        }).toString();

        const url = `/database-raw/list/load?${params}`;

        $.get(url, function(data) {
            // Array untuk menampung data yang akan dimasukkan ke Handsontable
            let tableData = [];
            let rowNum = 1;

            // Memformat data dari hasil fetch menjadi bentuk array yang dapat dimasukkan ke Handsontable
            data.forEach(function(video) {
                tableData.push([
                    rowNum++, 
                    video.account_name || 'No Data', 
                    video.campaign_name || 'No Data',
                    video.campaign_budget || 'No Data',
                    video.amount_spent_idr || 'No Data',
                    video.adds_of_payment_info || 'No Data',
                    video.cost_per_add_of_payment_info || 'No Data',
                    video.leads || 'No Data',
                    video.cost_per_lead || 'No Data',
                    video.donations || 'No Data',
                    video.reach || 'No Data',
                    video.impressions || 'No Data',
                    video.cpm || 'No Data',
                    video.link_clicks || 'No Data',
                    video.cpc || 'No Data',
                    video.purchases || 'No Data',
                    video.cost_per_purchase || 'No Data',
                    video.adds_to_cart || 'No Data',
                    video.cost_per_add_to_cart || 'No Data',
                    video.reporting_starts || 'No Data',
                    video.reporting_ends || 'No Data'
                ]);
            });

            // Update data pada Handsontable
            hot.loadData(tableData);
        });
    }
</script>

</body>
</html>
